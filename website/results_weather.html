<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>CMSC447 Project</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <style>
      body {
        padding-top: 54px;
      }
      @media (min-width: 992px) {
        body {
          padding-top: 56px;
        }
      }
      #map {
        height: 100%;
        width: 75%;
        position: absolute;
        
      }
      #query {
        margin: auto;
        position: absolute;
        width: 25%;

      }
      /* Get rid of arrows for number input boxes */
      input[type=number]::-webkit-inner-spin-button, 
      input[type=number]::-webkit-outer-spin-button { 
        -webkit-appearance: none; 
        margin: 0; 
      }
      /* Optional: Makes the sample page fill the window. */
      /*html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
*/
    </style>

  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="#">Start Bootstrap</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="index.html">Query
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">About</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
 
        <table width=100% height=100%>
        <tbody>
        <tr>
          <td width=75% height=100%>
            
            <div id="map"></div>      
            
        <script>
          var map;
          var usa = {lat: 37.0979817, lng: -98.9600287};
          function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: usa,
                zoom: 4
            });

          }
          </script>
          <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhOR2E6G3t8nrOqDF6WkgKEueL8YykS0c&callback=initMap"
          async defer></script>
          </td>

          <td width=25% height=100%>
            <div id="query" align="right">
            <form align="middle" width=100% height=100%>
                
                <br>
                City Population:
                <br>
                <input type="number" name="query_pop_min" id="query_pop_min" placeholder="Min" min="0" max="10000000" oninput="this.value = Math.abs(this.value)"> −
                <input type="number" name="query_pop_max" id="query_pop_max" placeholder="Max" min="0" max="10000000" oninput="this.value = Math.abs(this.value)">
                
                <br>
                <br>

                Average Property Values: ($)<span id="display_property">
                <br>
                <input type="number" name="query_prop_min" id="query_prop_min" placeholder="Min" min="0" max="1000000" oninput="this.value = Math.abs(this.value)"> −
                <input type="number" name="query_prop_max" id="query_prop_max" placeholder="Max" min="0" max="1000000" oninput="this.value = Math.abs(this.value)">
                
                <br>
                <br>
                
                Average temperature range: (°F)
                <br>
                <input type="number" name="query_temp_min" id="query_temp_min" placeholder="Min" min="0" max="120" oninput="this.value = Math.abs(this.value)"> −
                <input type="number" name="query_temp_max" id="query_temp_max" placeholder="Max" min="0" max="120" oninput="this.value = Math.abs(this.value)">
                
                <br>
                <br>

                Average number of sunny days:
                <br>
                <input type="number" name="query_sun_min" id="query_sun_min" placeholder="Min" min="0" max="364" oninput="this.value = Math.abs(this.value)"> −
                <input type="number" name="query_sun_max" id="query_sun_max" placeholder="Max" min="0" max="364" oninput="this.value = Math.abs(this.value)">
                
                <br>
                <br>

                Average humidity: (%)
                <br>
                <input type="number" name="query_humid_min" id="query_humid_min" placeholder="Min" min="0" max="100" oninput="this.value = Math.abs(this.value)"> −
                <input type="number" name="query_humid_max" id="query_humid_max" placeholder="Max" min="0" max="100" oninput="this.value = Math.abs(this.value)">
                
                <br>
                <br>

                Average rainfall: (in)
                <br>
                <input type="number" name="query_rain_min" id="query_rain_min" placeholder="Min" min="0" max="200" oninput="this.value = Math.abs(this.value)"> −
                <input type="number" name="query_rain_max" id="query_rain_max" placeholder="Max" min="0" max="200" oninput="this.value = Math.abs(this.value)">
                
                <br>
                <br>
                
                Average snowfall: (in)
                <br>
                <input type="number" name="query_snow_min" id="query_snow_min" placeholder="Min" min="0" max="220" oninput="this.value = Math.abs(this.value)"> −
                <input type="number" name="query_snow_max" id="query_snow_max" placeholder="Max" min="0" max="220" oninput="this.value = Math.abs(this.value)">
                
                <br>
                <br>

                Political Color:
                <br>
                <form action="">
                   <label for="query_color_blue" style="color:blue;"><input type="checkbox" name="query_color_blue" id="query_color_blue" value="blue">Blue</label>
                   <label for="query_color_red" style="color:red;"><input type="checkbox" name="query_color_red" id="query_color_red" value="red">Red</label>
                </form>

                <br>
                <br>

                Sort By: 
                <br>
                <select name="query_sort_param" id="query_sort_param">
                  <option value="population">Population</option>
                  <option value="propertyValue">Property Value</option>
                  <option value="temp">Temperature</option>
                  <option value="sunny">Sunny Days</option>
                  <option value="humidity">Humidity</option>
                  <option value="rain">Rain</option>
                  <option value="snow">Snow</option>
                  <option value="color">Political Color</option>
                </select>

                <br>

                <select name="query_sort_dir" id="query_sort_dir">
                  <option value="ASC">Low to High</option>
                  <option value="DESC">High to Low</option>
                </select>

                <br>
                <br>

                Number of results to return:
                <br>
                <input type="number" name="query_num_results" id="query_num_results" value="20" min="0" max="1000" oninput="this.value = Math.abs(this.value)">

                <br>
                <button type="button" onclick="handleSubmit()">Submit</button>
              
                <script type="text/javascript">
                    function handleSubmit() {
                        // Pass right political color
                        var query_color = (document.getElementById("query_color_red").checked && !document.getElementById("query_color_blue").checked) ? "red" : ""
                        query_color = (document.getElementById("query_color_blue").checked && !document.getElementById("query_color_red").checked) ? "blue" : ""

                      $.ajax({
                        url: "/getPoints",
                        //make an AJAX request to the py script
                        type: "POST",
                        //pass query params below
                        
                        data: { 
                                param_pop_min : document.getElementById("query_pop_min").value,
                                param_pop_max : document.getElementById("query_pop_max").value,
                                param_prop_min : document.getElementById("query_prop_min").value,
                                param_prop_max : document.getElementById("query_prop_max").value,
                                param_temp_min : document.getElementById("query_temp_min").value, 
                                param_temp_max : document.getElementById("query_temp_max").value,
                                param_sun_min : document.getElementById("query_sun_min").value,
                                param_sun_max : document.getElementById("query_sun_max").value,
                                param_humid_min : document.getElementById("query_humid_min").value,
                                param_humid_max : document.getElementById("query_humid_max").value,
                                param_rain_min : document.getElementById("query_rain_min").value,
                                param_rain_max : document.getElementById("query_rain_max").value,
                                param_snow_min : document.getElementById("query_snow_min").value,
                                param_snow_max : document.getElementById("query_snow_max").value,
                                param_color : query_color,
                                order_sort_by : document.getElementById("query_sort_param").value,
                                order_sort_dir : document.getElementById("query_sort_dir").value,
                                limit_num : document.getElementById("query_num_results").value
                                
                              },
                        success: callbackFunc
                      });
                    }


                    // the smooth zoom function
                    function smoothZoom (map, max, cnt) {
                        if (cnt >= max) {
                            return;
                        }
                        else {
                            z = google.maps.event.addListener(map, 'zoom_changed', function(event){
                                google.maps.event.removeListener(z);
                                smoothZoom(map, max, cnt + 1);
                            });
                            setTimeout(function(){map.setZoom(cnt)}, 80); // 80ms is what I found to work well on my system -- it might not work well on all systems
                        }
                    }  

                    /* JAY!!!
                       This is how the new json return is formatted
                       values are:
                            city.name, city.state
                            city.lat, city.lng
                            city.pop, city.prop
                            city.minTemp, city.maxTemp
                            city.sunny, city.humid, city.rain, city.snow
                            city.color */
                    function callbackFunc(response) {
                      //handle response here
                      //console.log(response);
                      var cities = JSON.parse(response);

                      cities.forEach(function(city) {
                          console.log(city.name);
                          console.log(city.lat, city.lng);

                          var marker = new google.maps.Marker({
                            position: {lat: city.lat, lng: city.lng},
                            map: map
                          });
                      });

                      var firstPos = {lat: cities[0].lat, lng: cities[0].lng};
                      //var newOptions = {'zoom':13, 'center':firstPos};
                      //map.setOptions(newOptions);
                      map.panTo(firstPos);
                      smoothZoom(map, 9, map.getZoom());
                      
                    }
                </script>
            </form>

            </div>
      
          </td>
          </tr>
        </tbody>
        </table>
        <!-- DivTable.com -->



    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  </body>

</html>
